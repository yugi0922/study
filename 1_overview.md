# SAP-C02について

この講義は **SAP-C02**（2025年9月時点）に沿って進めます。問題は長めのシナリオが中心で、設計の意思決定を選択肢から選ぶ試験です。配点は **D1=26% / D2=29% / D3=25% / D4=20%** です。合否は **750/1000以上** です。スコア対象65問に、将来評価用の非スコア問題が最大10問混ざります（見分けはつきません）。

解くときは **「要件 → 制約 → 失敗パターン → コスト/運用」** の順で考えます。Well-Architectedの6本柱を物差しにして、まず“標準的で安全な構成”を当てにいきます。

---

# 1. 組織の複雑性に対応する設計（26%）

複数アカウント・複数VPC・オンプレ連携を、運用しやすい構造にまとめます。責務はアカウントで分け、ネットワークは **Transit Gateway** をハブにします。共有機能や社内SaaSは **PrivateLink** で“見せたいポート”だけを出します。サービス間通信は **VPC Lattice** でポリシー管理をそろえます。名前解決は **Route 53 Resolver** のインバウンド/アウトバウンドでハイブリッド対応にします。

横断セキュリティは **IAM / IAM Identity Center / KMS / CloudTrail（組織統合）/ Security Hub / Inspector** を基盤にします。DRは **RTO/RPO** から方式（バックアップ復旧／パイロットライト／ウォームスタンバイ／マルチサイト）を選びます。コストは **タグ設計＋CUR/Cost Explorer/Budgets** に **Savings Plans/RI**、さらに **Compute Optimizer / S3 Storage Lens** で継続的に圧縮します。

つまずきやすい点は「便利だから直結してしまうこと」です。共有VPC直結より **PrivateLink** を優先します。クロスアカウントは **KMS鍵ポリシーとIAM** を両方そろえます。**CloudTrailの中央集約＋S3ブロックパブリックアクセス** まで入れて堅牢化します。NATとデータ転送料は“隠れコスト”なので常に監視します。

---

# 2. 新しいソリューション設計（29%）

要件から **IaC（CloudFormation/CDK）** と **デプロイ戦略（Blue/Green、Canary、自動ロールバック）** を先に決めます。可用性は **マルチAZ/マルチリージョン＋Route 53（レイテンシ/地理/ヘルスチェック）** を軸にします。性能は **キャッシュ（CloudFront/ElastiCache）** と **非同期化（SQS/SNS/EventBridge）**、必要に応じて **Kinesis/MSK** で作ります。

データは **S3各クラス / EFS / FSx / ブロック** を役割で使い分けます。DBは **Aurora/RDS**（柔軟なSQLやトランザクション）と **DynamoDB**（超スケール・サーバレス・アクセスパターン固定）のどちらが要件に合うかを言語化します。実行基盤は、サーバレスで足りるなら **Lambda** を優先し、そうでなければ **ECS/EKS** を運用境界（責務・チームスキル・可観測性）で選びます。

気をつける点は **TTL/リトライ/エクスポネンシャルバックオフ** の入れ忘れ、**Route 53のヘルスチェック未設定**、そして **AuroraとDynamoDBの選定理由があいまい** なことです。要件に「RTO=1分」「グローバル」「高スループット書き込み」が並ぶときは、**アクティブ-アクティブ＋レイテンシルーティング＋非同期複製** に寄せます。

---

# 3. 既存ソリューションの改善継続（25%）

まず“測れる状態”にします。**CloudWatch（メトリクス/ログ/アラーム/メトリクスマス）**、**X-Ray**、必要に応じて **OpenTelemetry** を入れます。信頼性は **Auto Scaling、キュー導入、再試行＋DLQ、SPOF排除、クォータ/Limit対応** で底上げします。セキュリティ運用は **Configルール、Secrets Manager / SSM Parameter、脆弱性とパッチ** を回します。コストは **Rightsizing、スポット/Savings Plans**、**NAT回避と経路最適化** で削ります。

改善は **効果 × 実装の容易さ × リスク** で優先度をつけ、小さく当ててすぐ測り、次に進めます。計測→変更→再計測のサイクルを短く保ちます。

---

# 4. 移行とモダナイゼーションの促進（20%）

最初に棚卸しをします。**Migration Evaluator / ADS** と **7R** を使って、どれをいつ、どう移すかを決めます。データ移行は **DMS（CDC）/SCT、DataSync、Snow Family** を、帯域・停止許容・データ特性で使い分けます。サーバ移行は **MGN** を前提に、**リハーサル→カットオーバー→ロールバック手順** を必ず用意します（DNS/TTLも含めます）。

モダン化は **Rehost → Replatform → Refactor** を段階的に併用します。**ECS/EKS/App Runner / Lambda**、**目的別DB（Aurora Serverless、DynamoDB、ElastiCache、Timestream/Neptune）**、**EventBridge / Step Functions** で疎結合にしていきます。一気に全部ではなく、**小さな成功を積み重ねる** 進め方にします。

---

# 模擬問の解き方テンプレ

1. **要件**（SLA、法令、運用、コスト）を書き出します。
2. **制約**（レガシー縛り、帯域、人員、期間）を洗い出します。
3. **失敗パターン**（単一障害点、リージョン障害、鍵管理、名前解決）を想像します。
4. **標準構成**（中央集約ログ、最小権限、暗号化、ヘルスチェック、Blue/Green）をまず当てます。
5. **過剰**（不要な自前運用、過度な多リージョン）を削ります。
6. **コスト/運用工数**で同点を裁定します（タグと可視化、自動化が回るかを確認します）。

---

# サービス選定の早見（口頭要約）

**ネットワーク**：多VPC/多拠点は **TGW**、提供者→消費者の単方向公開は **PrivateLink**、サービス間通信の標準化は **Lattice**、世界向けの経路最適化は **Global Accelerator** です。
**データベース**：トランザクションや柔軟なSQLは **Aurora/RDS**、超スケールでアクセスが決まっているなら **DynamoDB**、読み性能のボトルネックは **ElastiCache**、時系列/グラフは **Timestream/Neptune** です。
**統合**：**SQS** はメッセージキュー、**SNS** はPub/Sub、**EventBridge** はイベントルータ、**Step Functions** はオーケストレーションです。
**ストレージ**：**S3** は耐久性とコストでクラス選択、**EFS/FSx/ブロック** はPOSIXや性能要件で使い分けます。

---

# チェックリスト（直前確認）

**マルチアカウント**：OU/SCP、中央ログ、共有サービス、クロスアカウントアクセス、タグ/予算が整っているか。
**DR**：RTO/RPOから方式を選んだか。バックアップ計画と演習記録はあるか。
**セキュリティ運用**：最小権限IAM、鍵管理、監査証跡、パッチ/脆弱性、秘密情報管理が回っているか。
**コスト**：経路とNATを最適化したか。Savings Plans/RIとRightsizingは実施したか。可視化ダッシュボードはあるか。
**デプロイ**：IaC、Blue/Green/Canary、ロールバック、ヘルスチェック、SLO/指標は決まっているか。

---

# 演習（採点なし）

**演習1（D1）**：3アカウントを Control Tower 配下に編入し、中央ログ＋PrivateLink公開を設計します。狙いは **責務分離・監査可能性・最小露出** です。
**演習2（D2）**：世界配信APIの高可用設計を作ります。Route 53 レイテンシ＋ヘルスチェック、キャッシュ/非同期の使いどころを判断します。
**演習3（D3）**：CloudWatchメトリクスと請求データから、性能・信頼性・コストの改善ロードマップを作ります。
**演習4（D4）**：3層レガシーを Rehost→Replatform→Refactor の順に段階的に進めます。DMS（CDC）＋MGNで切替手順と戻し手順を書きます。


# 0. イントロ（試験と学習の前提）

■はじめに
この講義では、AWS認定ソリューションアーキテクト–プロフェッショナル（SAP-C02）の学習に必要な前提をそろえていきます。試験の形式や配点、問題の読み方のコツを押さえたうえで、Well-Architectedの6本柱を“設計の物差し”として使い、よく出る領域を効率よく学べるようにします。最後にチェックリストと用語のミニテストで理解を固めます。

---

## 1) 試験形式・配点・出題タイプ（読み方のコツと消去法）

まず試験の全体像です。問題はシナリオ文が長めで、実務の設計判断を問われます。複数の選択肢が“どれも良さそう”に見えることが多いので、読み方に型を持っておくと安定します。

読み方の型は次の順番にします。

1. **要件**：SLA、法令順守、運用体制、コストの条件を箇条書きで抜き出します。
2. **制約**：レガシー依存、帯域や期間、人員、地域などの縛りを分けて整理します。
3. **失敗パターン**：単一障害点、リージョン障害、鍵管理のミス、名前解決の問題などを想像します。
4. **標準で安全な構成**：最小権限、データ暗号化、中央集約ログ、ヘルスチェック、疎結合化を“まず当てにいく”意識で候補を作ります。
5. **消去法**：
   　・要件に明確に反するもの（可用性やセキュリティを落とす案）は先に切ります。
   　・“自前運用しすぎ”や“過剰構成”も基本は切ります。
6. **タイブレーク**：RTO/RPO、スループット、レイテンシ、費用、運用工数といった数量条件で最後の二択を決めます。

配点は4ドメインに分かれます。対策の優先度づけに使います。複数選択問題は“全部正しいものを選ぶ”必要があるので、**1つでも弱い根拠が混じる案は外す**と覚えておきます。

---

## 2) Well-Architected 6本柱を“設計フレーム”として使う

問題に迷ったら、6本柱に当てはめて考えます。

* **運用上の優秀性**：運用をコード化し、変更は小さく速く回します。
* **セキュリティ**：最小権限、暗号化、監査の見える化を徹底します。
* **信頼性**：冗長化と自動復旧、適切なDRで“壊れても戻る”ようにします。
* **パフォーマンス効率**：計測→ボトルネック特定→キャッシュや非同期で外します。
* **コスト最適化**：可視化→無駄の特定→購入モデル（SP/RI/スポット）で削ります。
* **サステナビリティ**：消費電力や利用率、データ寿命を意識して選びます。

この枠に当てると、選択肢の強み・弱みが比較しやすくなります。

---

## 3) 出題頻出カテゴリ（見る順番の“物差し”）

* **ネットワーク**：VPC/サブネット、Transit Gateway、**PrivateLink**、**VPC Lattice**、Direct Connect/VPN、Route 53（レイテンシ/地理/ヘルスチェック）。
* **ID/セキュリティ**：IAM／IAM Identity Center、KMS、ACM、CloudTrail（組織統合）、Security Hub、Inspector。**鍵ポリシーとIAMの整合**は頻出です。
* **DR・高可用**：RTO/RPO、バックアップ/復旧、パイロットライト、ウォームスタンバイ、マルチサイト、Elastic Disaster Recovery。
* **コスト**：タグ設計、CUR/Cost Explorer/Budgets、Savings Plans/RI、スポット、Compute Optimizer、S3 Storage Lens、**NAT/転送料**の最適化。
* **データベース**：Aurora/RDS、DynamoDB、ElastiCache、Redshift、Timestream/Neptune。**アクセスパターン起点**で選ぶのがコツです。
* **サーバレス＆統合**：Lambda、API Gateway、EventBridge、Step Functions、Kinesis/MSK。**疎結合＋非同期**が基本形です。
* **移行**：MGN、DMS/SCT、DataSync、Snow、Migration Hub、**7R**。現実的には段階的モダン化の設計が問われます。

---

## 4) 受講者用チェックリスト（直前5分で確認）

* 要件→制約→失敗パターン→**コスト/運用**の順で読む癖ができていますか。
* **最小権限・暗号化・中央ログ・ヘルスチェック**を“まず当てる”習慣がありますか。
* **PrivateLink / TGW / Lattice**の使い分けを一言で説明できますか。
* **Route 53**のルーティングポリシーと**ヘルスチェック**の使いどころは整理できていますか。
* **Aurora と DynamoDB**を“アクセスパターン”で選ぶ説明ができますか。
* **SQS / SNS / EventBridge**の役割の違いを言い分けられますか。
* **RTO/RPO → DR方式**の早見を持っていますか。
* **Savings Plans / RI / スポット**の違いと使いどころを言えますか。
* **DMS（CDC）/ MGN / DataSync / Snow**の使い分けを言語化できますか。
* **NAT と転送料**の“隠れコスト”を常に疑っていますか。

---

## 5) 用語ミニテスト（その場で口頭回答でOK）

1. **RTO と RPO** の違いは何ですか。
2. **PrivateLink** と **VPC Peering/TGW** の使いどころの違いを一言で説明してください。
3. **IAM Identity Center** を使う主目的は何ですか。
4. **DMS（CDC）** が得意な移行シーンはどれですか。
5. **MGN** を使うときの**カットオーバーの注意点**を一つ挙げてください。
6. **EventBridge** と **SNS** の役割の違いは何ですか。
7. **Route 53 のレイテンシルーティング** を使う典型的な要件は何ですか。
8. **KMS の鍵ポリシー** と **IAM ポリシー** の関係をどう理解しますか。
9. **Savings Plans** と **RI** の大きな違いを一つ挙げてください。
10. **DynamoDB** を選ぶ“決め手”になるアクセスパターンは何ですか。


# 1. 組織の複雑性に対応する設計（SAP-C02）

## このドメインで見られる力

* マルチアカウント・マルチVPC・ハイブリッド環境を、**安全で運用しやすい型**にまとめられるかを見られます。
* キーワードは **「境界の設計」「最小露出」「中央集約」「自動化」** です。
* 試験では“どれも動きそう”な選択肢が出ます。**一番安全で、監査できて、運用が回る**案を優先します。

---

## 0) 読み方の型（このドメイン版）

1. **誰が何をどこから使うか**（人/サービス、オンプレ/インターネット/別アカウント）。
2. **到達の向き**（提供者→消費者の一方向か、双方向か）。
3. **見せてよい範囲**（VPC内部を見せる必要があるか、エンドポイントだけでよいか）。
4. **監査と鍵**（証跡の集約、KMSの責任境界）。
5. **コストの地雷**（NAT、クロスAZ/リージョン、データ転送）。

---

## 1) アカウント戦略（境界の作り方）

### まずの結論

* **責務で分ける**のが基本です。`Security / Log-Archive / Network / Shared-Services / Workload(Prod/Dev/Stg)` の6役割が最小構成として安定します。
* **Control Tower + Organizations** を前提に、OUごとに **SCP** で“できないこと”を先に決めます。

### 代表SCP（よく出る考え方）

* ルートユーザー操作を禁止します。
* **許可リージョンを限定**します（不要リージョンはDeny）。
* **暗号化なしの作成を拒否**します（S3/EBS/RDS等）。
* **必須タグのない作成を拒否**します（コスト配賦と棚卸しのため）。

> ポイント：SCPは**上限**です。許可はIAM側。両輪で考えます。

---

## 2) IDと権限（人・サービスのアクセス）

### 人の認証・認可

* **IAM Identity Center** で人→ロールを一元化します。監査ログと権限棚卸しが楽になります。
* **Permission Boundary** を使うと、各チームに“上限つきの自由”を渡せます（サンドボックス向き）。

### サービス間の認可

* クロスアカウントは **AssumeRole** が基本です。
* **KMSは「鍵ポリシー × IAM」** の両方が通っていないと失敗します。ここは試験でよく落とし穴になります。
* 秘密情報は **Secrets Manager / SSM Parameter（SecureString）** に寄せて、ローテーション方針までセットにします。

---

## 3) ネットワーク（到達と最小露出）

### 選び分けの一言まとめ

| 要件                 | 最適解の第一候補                 | 理由（覚えやすく）                 |
| ------------------ | ------------------------ | ------------------------- |
| 多VPC/多拠点をハブで集約したい  | **Transit Gateway**      | ルート集中・スケール・運用が楽です         |
| 提供者→消費者の一方向で公開したい  | **PrivateLink**          | VPC内部を見せずに**最小露出**で配布できます |
| 小規模で相互通信だけ         | **VPC Peering**          | シンプル。ただし非推移・規模拡大に弱いです     |
| サービス間通信をL7で一元管理したい | **VPC Lattice**          | サービス単位の到達制御＋ポリシーが書けます     |
| オンプレと安定接続したい       | **Direct Connect(+VPN)** | 帯域・遅延の安定と冗長が目的です          |

### コストの地雷（覚えておきます）

* **NATはAZごと**に置きます。片AZ集中はクロスAZ課金の温床です。
* **S3/DynamoDBはGatewayエンドポイント**でNAT回避します。
* **PrivateLinkは集約発行**（共有アカウント）にすると数が増えても回しやすいです。

---

## 4) DNSと名前解決（ハイブリッドの定番）

* **Route 53 Resolver**

  * オンプレ → VPC は **インバウンド**、VPC → オンプレは **アウトバウンド** です。
  * ルールは**共有**してアカウント横断の手間を下げます。
* **Private Hosted Zone**

  * 間違いは「どのVPCにアタッチしているか」を見落とすことです。共有時は命名規則を決めます。
* **フェイルオーバーやレイテンシ**

  * ルーティングポリシーだけで満足しがちですが、**ヘルスチェックが無いと切り替わりません**。ここは頻出の罠です。

---

## 5) 監査・セキュリティの中央集約（“見える化”が先）

* **CloudTrail（Organizations統合）** を **Log-Archive** に集約します。S3は**ブロックパブリック**、**書き込み専用ポリシー**、**ライフサイクル**、可能なら**オブジェクトロック**を使います。
* **Security Hub（委任管理）** でベンチマークの違反を横断可視化します。
* **GuardDuty / Detective / Access Analyzer / AWS Config** を組み合わせて、侵害兆候・設定ドリフト・異常な外部共有を監視します。
* 監査の口癖は **「どこで、誰が、いつ、何に触ったか」** です。試験ではこの視点を満たす選択肢が正解に近いです。

---

## 6) 可用性とDR（RTO/RPOでメカニカルに選ぶ）

| RTO/RPO | 方式            | 使いどころ                       |
| ------- | ------------- | --------------------------- |
| 長めでOK   | **バックアップ/復旧** | AWS Backup＋クロスアカウント保管が手堅いです |
| 中くらい    | **パイロットライト**  | 最小リソース常時保持→切替時にスケールします      |
| もっと短い   | **ウォームスタンバイ** | 縮小版を常時待機。コストと可用性の中間です       |
| 最短が必要   | **マルチサイト**    | コスト最重ですが、切替は最速です            |

* サーバ移行/復旧なら **MGN / Elastic Disaster Recovery** の使い分けを押さえます。
* DNS切替は**低TTL＋ヘルスチェック**が定番セットです。

---

## 7) コスト（構造で先に削る）

* **タグ設計を必須化**して、コスト配賦・棚卸し・権限境界をそろえます。
* **CUR / Cost Explorer / Budgets / Cost Categories** をワンセットで“誰がいくら”を可視化します。
* コンピュートは **Savings Plans/RI + スポット** の組み合わせでベースと突発を分けます。
* **データ転送・NAT・クロスAZ/リージョン**はダッシュボードに入れて、毎月の改善の起点にします。

---

## 8) 運用の標準化（「人で頑張らない」をデフォルトに）

* **IaC（CloudFormation/CDK）** でアカウント横断の標準基盤を配ります。
* **Systems Manager** でパッチ、セッション管理、Runbook（Automation）、変更審査（Change Manager）、インシデント対応を共通化します。
* 監視は **可用性・遅延・エラー率・コスト** の4軸で **SLO** を決め、ダッシュボードを統一します。

---

## 9) 代表的な出題パターン（ミニケースで慣れます）

### ケースA：社内向けAPIを複数アカウントに配りたい

* 条件：提供者VPCの中身は見せたくない。消費者は複数アカウント。
* 正解の筋：**PrivateLink（Interface Endpoint）** を提供者側で発行し、消費者側はエンドポイント経由で到達します。
* 罠：VPC Peeringで直結、共有VPCに全部集約（**最小露出を満たさない**）。

### ケースB：VPC間接続がスパゲッティになってきた

* 条件：Peeringが増えすぎ、ルート管理が破綻。将来さらに増える予定。
* 正解の筋：**Transit Gateway** に集約してルーティングを一元化します。
* 罠：Peeringを増やし続ける（**非推移**で限界）、片側にNAT集中（**クロスAZ課金**）。

### ケースC：オンプレと双方向に名前解決したい

* 条件：オンプレ→VPC、VPC→オンプレの両方が必要。
* 正解の筋：**Resolverインバウンド/アウトバウンド** をそれぞれ設定し、ルール共有で横展開。
* 罠：Private Hosted Zoneだけで片付けようとする（**オンプレから解決できない**）。

### ケースD：クロスアカウントでS3暗号化バケットへ書き込みたい

* 条件：書込みは別アカウントのアプリ。KMSで暗号化。
* 正解の筋：**KMS鍵ポリシー** と **バケットポリシー** と **書込側IAM** を**三点セット**で調整します。
* 罠：IAMだけ直して満足（**鍵ポリシーで拒否**）、バケットのブロックパブリック未設定。

### ケースE：グローバルに可用性を上げたい

* 条件：マルチリージョンの冗長。自動切替したい。
* 正解の筋：**Route 53フェイルオーバー or レイテンシ**＋**ヘルスチェック**、状態同期は要件に合わせて選択。
* 罠：ポリシー設定だけでヘルスチェック無し（**切り替わらない**）。

---

## 10) 暗記カード（1行で思い出します）

* **「提供者→消費者」＝ PrivateLink、**「多対多」＝ TGW。
* **最小露出・監査可能・自動化**を満たす案が正解に寄ります。
* KMSは **鍵ポリシー × IAM**。どちらか片輪では動きません。
* DNS切替は **ヘルスチェック＋低TTL**。
* コストは **NAT・転送・クロスAZ** を疑って、**Gatewayエンドポイント**をまず当てます。

---

## 11) 直前チェック（□で確認）

* [ ] OU/アカウント分割を“責務”で説明できますか。
* [ ] **TGW / PrivateLink / Lattice / Peering** の一言選び分けを言えますか。
* [ ] 組織CloudTrail＋中央S3（削除防止/暗号化）を語れますか。
* [ ] **KMS鍵ポリシー × IAM × バケット/リソースポリシー** を三点セットで思い出せますか。
* [ ] **Gatewayエンドポイント**でNAT回避の説明ができますか。
* [ ] **RTO/RPO → DR方式**をメカニカルに選べますか。
* [ ] **Route 53ヘルスチェック**を忘れない自信がありますか。

---

## 12) まとめの一言

「**境界をはっきり切る → 見せる面を最小化する → 監査と自動化で回す**」。この順番で考えると、選択肢の優先順位が自然に決まります。試験では、この“型”に合う案がだいたい正解に近づきます。
